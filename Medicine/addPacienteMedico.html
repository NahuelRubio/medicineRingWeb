<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <!-- Importamos jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Importamos Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-auth-compat.js"></script>
    <!-- Firebase Storage -->
    <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-storage.js"></script>


    <title>MedicineRing</title>


    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">


    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-scholar.css">
    <link rel="stylesheet" href="assets/css/owl.css">
    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper@7/swiper-bundle.min.css" />
    <!--

TemplateMo 586 Scholar

https://templatemo.com/tm-586-scholar

-->
</head>

<body>

    <!-- ***** Preloader Start ***** -->
    <div id="js-preloader" class="js-preloader">
        <div class="preloader-inner">
            <span class="dot"></span>
            <div class="dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </div>
    <!-- ***** Preloader End ***** -->
    <!-- The actual snackbar -->
    <div id="snackbar">Paciente añadido con exito.</div>
    <!-- ***** Header Area Start ***** -->
    <header class="header-area header-sticky">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">
                        <!-- ***** Logo Start ***** -->
                        <a href="index.html" class="logo">
                            <h1>MedicineRing</h1>
                        </a>
                        <!-- ***** Logo End ***** -->
                        <!-- ***** Menu Start ***** -->
                        <ul class="nav">
                            <li class="scroll-to-section"><a href="indexCorrectoMedico.html">Inicio</a></li>
                            <li class="scroll-to-section"><a href="pacientes_SoyMedico.html">Pacientes</a></li>
                            <li class="scroll-to-section"><a href="addPacienteMedico.html" class="active">Añadir
                                    paciente</a></li>
                            <li class="scroll-to-section"><a href="about_us_sesion_Medico.html">Sobre nostros</a></li>
                            <li class="scroll-to-section"><a href="index.html">Cerrar Sesión</a></li>
                        </ul>
                        <a class='menu-trigger'>
                            <span>Menu</span>
                        </a>
                        <!-- ***** Menu End ***** -->
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <!-- ***** Header Area End ***** -->

    <div class="main-banner" id="top">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="owl-carousel owl-banner">
                        <div class="header-text">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="contact-us section" id="contact">
        <div class="container">
            <div class="row">
                <div class="col-lg-6  align-self-center">
                    <div class="section-heading">
                        <h6>Añadir Paciente </h6>
                        <h2></h2>
                        <p>Añada un paciente a su lista de pacientes.</p>
                        <br>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="contact-us-content">
                        <form id="contact-form" action="" method="post">
                            <div class="row">
                                <div class="col-lg-12">
                                    <fieldset>
                                        <h4>Seleccione Paciente</h4>
                                        <br>
                                        <select name="pacientes" id="pacientes">

                                        </select>
                                    </fieldset>
                                    <div class="col-lg-12">
                                        <fieldset>
                                            <br>
                                            <button id="form-submit" class="orange-button">Añadir
                                                paciente</button>
                                        </fieldset>
                                    </div>
                                </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <div class="container">
          <div class="col-lg-12">
            <p>Copyright © 2023 MedicineRing. All rights reserved. &nbsp;&nbsp;&nbsp; Design: <a
                href="://www.linkedin.com/in/nahuel-javier-rubio-prada-4500b4139/" rel="nofollow" target="_blank">Nahuel
                Rubio Prada</a></p>
                <p> <a href="inicio_sesion_medico.html" rel="nofollow" >Iniciar sesion medico</a></p>
                <p> <a href="registro_medico.html" rel="nofollow">Registrar sesion medico</a></p>
    
          </div>
    
        </div>
      </footer>
    <!-- Scripts -->
    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/isotope.min.js"></script>
    <script src="assets/js/owl-carousel.js"></script>
    <script src="assets/js/counter.js"></script>
    <script src="assets/js/custom.js"></script>
    <script>

        function check_cookie_name(name) {
            var match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
            if (match) {
                return (match[2]);
            }
            else {
                console.log('--something went wrong---');
            }
        }
        // Configuramos Firebase
        var firebaseConfig = {
            apiKey: "AIzaSyC33rG5Or8Lz_pe9d-PQ4-24QPYGR2y55o",
            authDomain: "medicinering.firebaseapp.com",
            projectId: "medicinering",
            storageBucket: "medicinering.appspot.com",
            messagingSenderId: "659612075181",
            appId: "1:659612075181:web:8a3b7c7487655935553224"
        };
        firebase.initializeApp(firebaseConfig);
        // Obtiene la referencia a la colección "paciente"
        const pacientesRef = firebase.firestore().collection("paciente");

        // Recupera los documentos de la colección "paciente"
        pacientesRef.get().then((querySnapshot) => {
            let pacientesSelect = $("#pacientes");

            // Agrega las opciones al combobox
            querySnapshot.forEach((doc) => {
                pacientesSelect.append($("<option>").val(doc.id).text(doc.data().name));
            });


        });
        document.addEventListener("DOMContentLoaded", function () {
            // Agregar evento de click al botón 'Agregar'
            $("#form-submit").on("click", function (e) {
                e.preventDefault();

                const selectElement = document.getElementById("pacientes");

                // Obtener el texto del elemento <option> seleccionado
                const selectedOptionText = selectElement.options[selectElement.selectedIndex].textContent;

                // Aquí se ejecuta el código una vez que el DOM ha sido cargado
                console.log("El DOM ha sido cargado");
                console.log(selectedOptionText);
                pacientesRef.get().then((querySnapshot) => {
                    // Agrega las opciones al combobox

                    querySnapshot.forEach((doc) => {
                        pacientesRef.where("name", "==", selectedOptionText)
                            .get()
                            .then((querySnapshot) => {
                                querySnapshot.forEach((doc) => {
                                    // Agregar el campo "id" al documento y mantener los campos existentes
                                    const data = doc.data();
                                    const newData = { ...data, id: check_cookie_name('id') };
                                    // Actualizar el documento con el nuevo campo "id"
                                    pacientesRef.doc(doc.id).update(newData)
                                        .then(() => {
                                            console.log("Documento actualizado con éxito");
                                            var x = document.getElementById("snackbar");
                                            // Add the "show" class to DIV
                                            x.className = "show";
                                            // After 3 seconds, remove the show class from DIV
                                            setTimeout(function () { x.className = x.className.replace("show", ""); }, 3000);
                                        })
                                        .catch((error) => {
                                            console.error("Error al actualizar el documento: ", error);
                                        });
                                });
                            })
                            .catch((error) => {
                                console.error("Error al buscar el documento: ", error);
                            });
                    });

                });
            });

            /*
                        // Obtener el valor seleccionado
                        const selectedOption = selectElement.value;
                        // Obtener referencia a la colección "users"
                        const usersRef = firebase.firestore().collection("paciente");
            
                        // Buscar el documento por su nombre
                        usersRef.where("name", "==", selectedOption)
                            .get()
                            .then((querySnapshot) => {
                                querySnapshot.forEach((doc) => {
                                    // Agregar el campo "id" al documento y mantener los campos existentes
                                    const data = doc.data();
                                    const newData = { ...data, id: check_cookie_name('id') };
                                    // Actualizar el documento con el nuevo campo "id"
                                    usersRef.doc(doc.id).update(data)
                                        .then(() => {
                                            console.log("Documento actualizado con éxito");
                                        })
                                        .catch((error) => {
                                            console.error("Error al actualizar el documento: ", error);
                                        });
                                });
                            })
                            .catch((error) => {
                                console.error("Error al buscar el documento: ", error);
                            });*/
        });

    </script>
</body>

</html>